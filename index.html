<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#1a365d">
    <title>The Way - Torah Study</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        :root {
            --primary: #1a365d;
            --secondary: #2c5282;
            --accent: #d69e2e;
            --text: #2d3748;
            --bg: #f7fafc;
            --card-bg: #ffffff;
            --border: #e2e8f0;
            --success: #48bb78;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: var(--text);
        }

        .app-container {
            max-width: 480px;
            margin: 0 auto;
            background: var(--bg);
            min-height: 100vh;
            box-shadow: 0 0 40px rgba(0,0,0,0.1);
        }

        .header {
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            color: white;
            padding: 20px;
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .app-title {
            font-size: 24px;
            font-weight: bold;
        }

        .app-subtitle {
            font-size: 11px;
            opacity: 0.8;
            margin-top: 2px;
        }

        .hebrew-date {
            font-size: 14px;
            opacity: 0.9;
            margin-top: 5px;
        }

        .menu-btn {
            background: none;
            border: none;
            color: white;
            font-size: 24px;
            cursor: pointer;
            padding: 5px;
        }

        .dropdown-menu {
            display: none;
            position: absolute;
            right: 20px;
            top: 70px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            padding: 10px 0;
            min-width: 200px;
            z-index: 101;
        }

        .dropdown-menu.show { display: block; }

        .dropdown-item {
            padding: 12px 20px;
            cursor: pointer;
            color: var(--text);
        }

        .dropdown-item:hover { background: var(--bg); }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 200;
        }

        .modal.show {
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            background: white;
            border-radius: 12px;
            max-width: 400px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
        }

        .modal-header {
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            color: white;
            padding: 20px;
            border-radius: 12px 12px 0 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-title {
            font-size: 20px;
            font-weight: bold;
        }

        .modal-close {
            background: none;
            border: none;
            color: white;
            font-size: 24px;
            cursor: pointer;
            width: 30px;
            height: 30px;
        }

        .modal-body {
            padding: 20px;
            line-height: 1.6;
        }

        .modal-body h3 {
            color: var(--primary);
            margin: 15px 0 10px 0;
        }

        .modal-body ul {
            margin-left: 20px;
        }

        .nav-tabs {
            display: flex;
            background: white;
            border-bottom: 1px solid var(--border);
            position: sticky;
            top: 85px;
            z-index: 90;
        }

        .nav-tab {
            flex: 1;
            padding: 15px;
            text-align: center;
            background: none;
            border: none;
            cursor: pointer;
            font-weight: 500;
            font-size: 14px;
            position: relative;
        }

        .nav-tab.active {
            color: var(--primary);
        }

        .nav-tab.active::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: var(--accent);
        }

        .content-section {
            display: none;
            padding: 20px;
        }

        .content-section.active {
            display: block;
        }

        .card {
            background: var(--card-bg);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 15px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }

        .card-title {
            font-size: 18px;
            font-weight: bold;
            color: var(--primary);
            margin-bottom: 15px;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.3s;
        }

        .btn-primary {
            background: var(--primary);
            color: white;
        }

        .btn-primary:hover {
            background: var(--secondary);
        }

        .btn-secondary {
            background: white;
            color: var(--primary);
            border: 2px solid var(--primary);
        }

        .verse {
            padding: 10px;
            margin: 5px 0;
            border-radius: 6px;
            cursor: pointer;
        }

        .verse:hover {
            background: #f8f9fa;
        }

        .verse.selected {
            background: #fff7e6;
            border-left: 3px solid var(--accent);
        }

        .verse.highlighted {
            background: #fefcbf;
        }

        .verse-number {
            color: var(--accent);
            font-weight: bold;
            margin-right: 5px;
        }

        .hebrew-text {
            font-size: 20px;
            direction: rtl;
            text-align: right;
            margin: 15px 0;
            line-height: 2;
            color: var(--primary);
        }

        .hebrew-interlinear {
            font-size: 24px;
            direction: rtl;
            text-align: right;
            margin: 20px 0;
            line-height: 3.5;
            color: var(--primary);
            background: #f7fafc;
            padding: 20px;
            border-radius: 8px;
        }

        .hebrew-word-group {
            display: inline-block;
            position: relative;
            margin: 0 8px;
            padding-bottom: 25px;
        }

        .hebrew-word {
            display: block;
            font-size: 24px;
            color: var(--primary);
        }

        .english-gloss {
            position: absolute;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            font-size: 11px;
            color: #718096;
            direction: ltr;
            white-space: nowrap;
            background: white;
            padding: 2px 4px;
            border-radius: 3px;
        }

        .commentary-btn {
            padding: 8px 15px;
            border: 2px solid var(--border);
            background: white;
            border-radius: 20px;
            cursor: pointer;
            font-size: 14px;
            margin: 5px;
        }

        .commentary-btn.active {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }

        .commentary-content {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin-top: 10px;
            border-left: 4px solid var(--accent);
            line-height: 1.8;
        }

        .notes-textarea {
            width: 100%;
            min-height: 100px;
            padding: 12px;
            border: 1px solid var(--border);
            border-radius: 8px;
            font-family: inherit;
            resize: vertical;
        }

        .note-item {
            background: #fffbeb;
            border-left: 3px solid var(--accent);
            padding: 10px;
            margin-bottom: 10px;
            border-radius: 4px;
        }

        .note-verse {
            font-weight: bold;
            color: var(--primary);
            margin-bottom: 5px;
        }

        .note-date {
            font-size: 12px;
            color: #718096;
            margin-bottom: 5px;
        }

        .note-text {
            margin-bottom: 8px;
        }

        .note-delete {
            color: #f56565;
            background: none;
            border: none;
            cursor: pointer;
            font-size: 12px;
            padding: 4px 8px;
        }

        .toast {
            position: fixed;
            bottom: -100px;
            left: 50%;
            transform: translateX(-50%);
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px 25px;
            border-radius: 8px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            z-index: 1000;
            transition: bottom 0.3s;
        }

        .toast.show {
            bottom: 30px;
        }

        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 2px;
            background: var(--border);
            border: 1px solid var(--border);
            border-radius: 8px;
            overflow: hidden;
        }

        .calendar-day-header {
            background: var(--primary);
            color: white;
            padding: 10px 5px;
            text-align: center;
            font-weight: bold;
            font-size: 12px;
        }

        .calendar-day {
            background: white;
            min-height: 80px;
            padding: 8px;
        }

        .calendar-day.today {
            background: #e6fffa;
            border: 2px solid var(--accent);
        }

        .calendar-day.shabbat {
            background: #e6ecff;
        }

        .calendar-day-number {
            font-weight: bold;
            margin-bottom: 2px;
        }

        .calendar-day-hebrew {
            font-size: 10px;
            color: #718096;
            direction: rtl;
        }

        .calendar-festival {
            font-size: 9px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 2px 4px;
            border-radius: 3px;
            margin-top: 2px;
        }

        .calendar-type-btn {
            padding: 12px;
            border: 2px solid var(--primary);
            background: white;
            color: var(--primary);
            border-radius: 8px;
            cursor: pointer;
            font-size: 13px;
        }

        .calendar-type-btn.active {
            background: var(--primary);
            color: white;
        }

        .external-link {
            display: inline-flex;
            align-items: center;
            gap: 5px;
            padding: 8px 12px;
            background: white;
            border: 1px solid var(--border);
            border-radius: 6px;
            text-decoration: none;
            color: var(--primary);
            font-size: 13px;
            margin: 5px;
        }

        .external-link:hover {
            background: var(--primary);
            color: white;
        }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- Header -->
    <base href="/The-Way/">
        <div class="header">
            <div class="header-content">
                <div>
                    <div class="app-title">âœ¡ï¸ The Way</div>
                    <div class="app-subtitle">100% Open Source Torah Study</div>
                    <div class="hebrew-date" id="hebrewDate">Loading...</div>
                </div>
                <button class="menu-btn" onclick="toggleMenu()">â˜°</button>
            </div>
            
            <div class="dropdown-menu" id="dropdownMenu">
                <div class="dropdown-item" onclick="showModal('aboutModal')">ğŸ“– About</div>
                <div class="dropdown-item" onclick="showModal('settingsModal')">âš™ï¸ Settings</div>
                <div class="dropdown-item" onclick="showModal('donateModal')">ğŸ’ Support</div>
                <div class="dropdown-item" onclick="shareApp()">ğŸ“¤ Share</div>
            </div>
        </div>

        <!-- About Modal -->
        <div class="modal" id="aboutModal" role="dialog" aria-modal="true" aria-labelledby="aboutModalTitle" onclick="closeModalOnClick(event, 'aboutModal')">
            <div class="modal-content">
                <div class="modal-header">
                    <div class="modal-title" id="aboutModalTitle">ğŸ“– About The Way</div>
                    <button class="modal-close" aria-label="Close dialog" onclick="closeModal('aboutModal')">Ã—</button>
                </div>
                <div class="modal-body">
                    <h3>Our Mission</h3>
                    <p>Free, open-source Torah study for everyone.</p>
                    
                    <h3>100% Open Source</h3>
                    <ul>
                        <li>Sefaria.org (CC-BY-SA)</li>
                        <li>JPS 1917 Translation</li>
                        <li>Classical Commentaries</li>
                    </ul>

                    <h3>Version</h3>
                    <p>The Way v2.0 - October 2025</p>
                </div>
            </div>
        </div>

        <!-- Settings Modal -->
        <div class="modal" id="settingsModal" role="dialog" aria-modal="true" aria-labelledby="settingsModalTitle" onclick="closeModalOnClick(event, 'settingsModal')">
            <div class="modal-content">
                <div class="modal-header">
                    <div class="modal-title" id="settingsModalTitle">âš™ï¸ Settings</div>
                    <button class="modal-close" aria-label="Close dialog" onclick="closeModal('settingsModal')">Ã—</button>
                </div>
                <div class="modal-body">
                    <h3>Display Settings</h3>
                    <p>Auto-save enabled by default</p>
                    <p>All settings persist automatically</p>
                </div>
            </div>
        </div>

        <!-- Donate Modal -->
        <div class="modal" id="donateModal" role="dialog" aria-modal="true" aria-labelledby="donateModalTitle" onclick="closeModalOnClick(event, 'donateModal')">
            <div class="modal-content">
                <div class="modal-header">
                    <div class="modal-title" id="donateModalTitle">ğŸ’ Support</div>
                    <button class="modal-close" aria-label="Close dialog" onclick="closeModal('donateModal')">Ã—</button>
                </div>
                <div class="modal-body">
                    <h3>Coming Soon</h3>
                    <p>We're currently in beta testing. Donation options will be available after the official launch.</p>
                    
                    <h3>Our Mission</h3>
                    <p>When available, donations will support:</p>
                    <ul style="margin-left: 20px; line-height: 1.8;">
                        <li>Free Torah education for all</li>
                        <li>App development and maintenance</li>
                        <li>Feeding orphans and widows</li>
                    </ul>
                    
                    <p style="margin-top: 15px; font-style: italic; color: #718096;">
                        "Whoever is generous to the poor lends to the LORD" - Proverbs 19:17
                    </p>
                </div>
            </div>
        </div>

        <!-- Navigation -->
        <nav class="nav-tabs">
            <button class="nav-tab active" onclick="switchTab(this,'daily')">Daily</button>
            <button class="nav-tab" onclick="switchTab(this,'torah')">Torah</button>
            <button class="nav-tab" onclick="switchTab(this,'parasha')">Parasha</button>
            <button class="nav-tab" onclick="switchTab(this,'calendar')">Calendar</button>
            <button class="nav-tab" onclick="switchTab(this,'resources')">Resources</button>
        </nav>

        <!-- Daily Section -->
        <div class="content-section active" id="daily">
            <div class="card">
                <div class="card-title">Today's Torah Portion</div>
                
                <button class="btn btn-primary" onclick="toggleInterlinear()" style="margin-bottom: 15px;">
                    ğŸ“– Toggle Word-by-Word
                </button>
                
                <div class="hebrew-interlinear" id="interlinearText" style="display: none;">
                    <div style="margin-bottom: 10px; font-size: 14px; color: var(--accent); direction: ltr; text-align: left;">
                        Genesis 1:1 - Read right-to-left â†’
                    </div>
                    <span class="hebrew-word-group">
                        <span class="hebrew-word">×‘Ö°Ö¼×¨Öµ××©Ö´××™×ª</span>
                        <span class="english-gloss">in-beginning</span>
                    </span>
                    <span class="hebrew-word-group">
                        <span class="hebrew-word">×‘Ö¸Ö¼×¨Ö¸×</span>
                        <span class="english-gloss">created</span>
                    </span>
                    <span class="hebrew-word-group">
                        <span class="hebrew-word">×Ö±×œÖ¹×”Ö´×™×</span>
                        <span class="english-gloss">God</span>
                    </span>
                    <span class="hebrew-word-group">
                        <span class="hebrew-word">×Öµ×ª</span>
                        <span class="english-gloss">[obj]</span>
                    </span>
                    <span class="hebrew-word-group">
                        <span class="hebrew-word">×”Ö·×©Ö¸Ö¼××Ö·×™Ö´×</span>
                        <span class="english-gloss">heavens</span>
                    </span>
                    <span class="hebrew-word-group">
                        <span class="hebrew-word">×•Ö°×Öµ×ª</span>
                        <span class="english-gloss">and-[obj]</span>
                    </span>
                    <span class="hebrew-word-group">
                        <span class="hebrew-word">×”Ö¸×Ö¸×¨Ö¶×¥</span>
                        <span class="english-gloss">earth</span>
                    </span>
                </div>
                
                <div class="hebrew-text" id="regularHebrew">
                    ×‘Ö°Ö¼×¨Öµ××©Ö´××™×ª ×‘Ö¸Ö¼×¨Ö¸× ×Ö±×œÖ¹×”Ö´×™× ×Öµ×ª ×”Ö·×©Ö¸Ö¼××Ö·×™Ö´× ×•Ö°×Öµ×ª ×”Ö¸×Ö¸×¨Ö¶×¥
                </div>
                
                <p><span class="verse-number">1:1</span> In the beginning God created the heaven and the earth.</p>
            </div>

            <div class="card">
                <div class="card-title">Commentaries</div>
                <div>
                    <button class="commentary-btn active" onclick="loadCommentary(this,'rashi')">Rashi</button>
                    <button class="commentary-btn" onclick="loadCommentary(this,'ibn-ezra')">Ibn Ezra</button>
                    <button class="commentary-btn" onclick="loadCommentary(this,'sforno')">Sforno</button>
                    <button class="commentary-btn" onclick="loadCommentary(this,'ramban')">Ramban</button>
                </div>
                <div class="commentary-content" id="commentaryContent">
                    <strong>Rashi on Genesis 1:1:</strong><br>
                    In the beginning of God's creating the heavens and the earth...
                </div>
            </div>

            <div class="card">
                <div class="card-title">Free Resources</div>
                <a href="https://www.sefaria.org/Genesis.1" class="external-link" target="_blank">ğŸ“š Sefaria</a>
                <a href="https://www.torahclass.com" class="external-link" target="_blank">ğŸ“ TorahClass</a>
            </div>
        </div>

        <!-- Torah Section -->
        <div class="content-section" id="torah">
            <div class="card">
                <div style="display: grid; grid-template-columns: repeat(5, 1fr); gap: 8px; margin-bottom: 15px;">
                    <button class="btn btn-primary book-select-btn" data-book="genesis" onclick="selectBook('genesis')" style="padding: 8px 4px; font-size: 12px;">
                        Genesis<br><small style="font-size: 9px;">×‘Ö°Ö¼×¨Öµ××©Ö´××™×ª</small>
                    </button>
                    <button class="btn btn-secondary book-select-btn" data-book="exodus" onclick="selectBook('exodus')" style="padding: 8px 4px; font-size: 12px;">
                        Exodus<br><small style="font-size: 9px;">×©Ö°×××•Ö¹×ª</small>
                    </button>
                    <button class="btn btn-secondary book-select-btn" data-book="leviticus" onclick="selectBook('leviticus')" style="padding: 8px 4px; font-size: 12px;">
                        Leviticus<br><small style="font-size: 9px;">×•Ö·×™Ö´Ö¼×§Ö°×¨Ö¸×</small>
                    </button>
                    <button class="btn btn-secondary book-select-btn" data-book="numbers" onclick="selectBook('numbers')" style="padding: 8px 4px; font-size: 12px;">
                        Numbers<br><small style="font-size: 9px;">×‘Ö°Ö¼×Ö´×“Ö°×‘Ö·Ö¼×¨</small>
                    </button>
                    <button class="btn btn-secondary book-select-btn" data-book="deuteronomy" onclick="selectBook('deuteronomy')" style="padding: 8px 4px; font-size: 12px;">
                        Deut.<br><small style="font-size: 9px;">×“Ö°Ö¼×‘Ö¸×¨Ö´×™×</small>
                    </button>
                </div>

                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                    <div class="card-title" style="margin: 0;">
                        <span id="currentBook">Genesis</span> <span id="currentChapter">1</span>
                    </div>
                    <div style="display: flex; gap: 8px;">
                        <button class="btn btn-primary" onclick="changeChapter(-1)" style="padding: 8px 12px; font-size: 13px;">â† Prev</button>
                        <button class="btn btn-primary" onclick="changeChapter(1)" style="padding: 8px 12px; font-size: 13px;">Next â†’</button>
                    </div>
                </div>

                <div style="display: flex; gap: 8px; margin-bottom: 15px; flex-wrap: wrap;">
                    <button class="btn btn-secondary" onclick="highlightVerse()" style="padding: 8px 12px; font-size: 13px;">ğŸ–ï¸ Highlight</button>
                    <button class="btn btn-secondary" onclick="showNoteInput()" style="padding: 8px 12px; font-size: 13px;">ğŸ“ Note</button>
                    <button class="btn btn-secondary" onclick="shareVerse()" style="padding: 8px 12px; font-size: 13px;">ğŸ“¤ Share</button>
                </div>
            </div>

            <div class="card" id="versesContainer">
                <div class="verse" data-verse="1:1" onclick="selectVerse(this)">
                    <span class="verse-number">1:1</span> 
                    <span class="verse-text">In the beginning God created the heaven and the earth.</span>
                </div>
                <div class="verse" data-verse="1:2" onclick="selectVerse(this)">
                    <span class="verse-number">1:2</span> 
                    <span class="verse-text">And the earth was without form, and void; and darkness was upon the face of the deep.</span>
                </div>
                <div class="verse" data-verse="1:3" onclick="selectVerse(this)">
                    <span class="verse-number">1:3</span> 
                    <span class="verse-text">And God said, Let there be light: and there was light.</span>
                </div>
                <div class="verse" data-verse="1:4" onclick="selectVerse(this)">
                    <span class="verse-number">1:4</span> 
                    <span class="verse-text">And God saw the light, that it was good.</span>
                </div>
                <div class="verse" data-verse="1:5" onclick="selectVerse(this)">
                    <span class="verse-number">1:5</span> 
                    <span class="verse-text">And God called the light Day, and the darkness Night.</span>
                </div>
            </div>

            <div class="card">
                <div class="card-title">ğŸ“ My Notes</div>
                <div id="notesDisplay">
                    <p style="color: #718096; font-style: italic;">No notes yet. Select a verse and click "Note"</p>
                </div>
                <div id="noteInput" style="display: none;">
                    <textarea id="noteTextarea" class="notes-textarea" placeholder="Add your note..."></textarea>
                    <div style="margin-top: 10px;">
                        <button class="btn btn-primary" onclick="saveNote()">Save</button>
                        <button class="btn btn-secondary" onclick="hideNoteInput()">Cancel</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Parasha Section -->
        <div class="content-section" id="parasha">
            <div class="card">
                <div class="card-title">Weekly Torah Cycle</div>
                <p><strong>Current: Bereshit (Genesis 1:1-6:8)</strong></p>
                <p style="margin-top: 15px;">The Torah is divided into 54 weekly portions read throughout the year.</p>
                
                <h3 style="margin-top: 20px; color: var(--primary);">Upcoming Portions:</h3>
                <ul style="margin-left: 20px; margin-top: 10px; line-height: 1.8;">
                    <li><strong>Bereshit:</strong> Genesis 1:1-6:8</li>
                    <li><strong>Noach:</strong> Genesis 6:9-11:32</li>
                    <li><strong>Lech-Lecha:</strong> Genesis 12:1-17:27</li>
                </ul>
            </div>
        </div>

            <!-- Calendar Section -->
            <div class="content-section" id="calendar">
                <div class="card">
                    <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; margin-bottom: 20px;" data-role="calendar-tabs">
                        <button class="calendar-type-btn active" onclick="switchCalendar(this,'hebrew')">ğŸ“… Hebrew</button>
                        <button class="calendar-type-btn" onclick="switchCalendar(this,'dss')">ğŸ“œ DSS</button>
                    </div>
                </div>

                <div id="hebrewCalendar">
                    <div class="card">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                            <div class="card-title" style="margin: 0;" id="currentMonth">October 2025</div>
                            </div>
                            </div>
                    <!-- Resources Section -->
                        </div>
                        <div id="calendarContainer">
                            <div class="calendar-grid" id="calendarGrid"></div>
                        </div>
                    </div>
                </div>

                <div id="dssCalendar" style="display: none;">
                    <div class="card">
                        <div class="card-title">ğŸ“œ Dead Sea Scrolls Calendar - 364 Days</div>
                        <p style="margin-bottom: 15px;">The Qumran community used a 364-day solar calendar where every date falls on the same weekday each year. Perfect mathematical precision.</p>
                        
                        <div style="background: linear-gradient(135deg, #f6f9fc 0%, #eef2f7 100%); padding: 15px; border-radius: 8px; margin-bottom: 20px;">
                            <div style="text-align: center; margin-bottom: 10px;">
                                <div style="font-size: 18px; font-weight: bold; color: var(--primary);">Current DSS Date</div>
                                <div id="dssCurrentDate" style="font-size: 16px; color: var(--accent); margin-top: 5px;">Calculating...</div>
                            </div>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-title">ğŸ“Š Calendar Structure - 4 Quarters</div>
                        <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; margin-top: 15px;">
                            <div style="background: linear-gradient(135deg, #e6fffa 0%, #b2f5ea 100%); padding: 15px; border-radius: 8px;">
                                <div style="font-size: 24px; margin-bottom: 5px;">ğŸŒ¸</div>
                                <h4 style="color: var(--primary); margin-bottom: 10px; font-size: 14px;">Spring Quarter</h4>
                                <div style="font-size: 12px; line-height: 1.6;">
                                    <strong>Months 1-3:</strong><br>
                                    1. Nisan (30 days)<br>
                                    2. Iyar (30 days)<br>
                                    3. Sivan (30 days)<br>
                                    <strong>+ 1 Tekufah day</strong><br>
                                    <strong>= 91 days total</strong>
                                </div>
                            </div>
                            
                            <div style="background: linear-gradient(135deg, #fff7e6 0%, #ffd89b 100%); padding: 15px; border-radius: 8px;">
                                <div style="font-size: 24px; margin-bottom: 5px;">â˜€ï¸</div>
                                <h4 style="color: var(--primary); margin-bottom: 10px; font-size: 14px;">Summer Quarter</h4>
                                <div style="font-size: 12px; line-height: 1.6;">
                                    <strong>Months 4-6:</strong><br>
                                    4. Tammuz (30 days)<br>
                                    5. Av (30 days)<br>
                                    6. Elul (30 days)<br>
                                    <strong>+ 1 Tekufah day</strong><br>
                                    <strong>= 91 days total</strong>
                                </div>
                            </div>
                            
                            <div style="background: linear-gradient(135deg, #ffe6e6 0%, #ffb3b3 100%); padding: 15px; border-radius: 8px;">
                                <div style="font-size: 24px; margin-bottom: 5px;">ğŸ‚</div>
                                <h4 style="color: var(--primary); margin-bottom: 10px; font-size: 14px;">Fall Quarter</h4>
                                <div style="font-size: 12px; line-height: 1.6;">
                                    <strong>Months 7-9:</strong><br>
                                    7. Tishrei (30 days)<br>
                                    8. Cheshvan (30 days)<br>
                                    9. Kislev (30 days)<br>
                                    <strong>+ 1 Tekufah day</strong><br>
                                    <strong>= 91 days total</strong>
                                </div>
                            </div>
                            
                            <div style="background: linear-gradient(135deg, #e6ecff 0%, #b3c7ff 100%); padding: 15px; border-radius: 8px;">
                                <div style="font-size: 24px; margin-bottom: 5px;">â„ï¸</div>
                                <h4 style="color: var(--primary); margin-bottom: 10px; font-size: 14px;">Winter Quarter</h4>
                                <div style="font-size: 12px; line-height: 1.6;">
                                    <strong>Months 10-12:</strong><br>
                                    10. Tevet (30 days)<br>
                                    11. Shevat (30 days)<br>
                                    12. Adar (30 days)<br>
                                    <strong>+ 1 Tekufah day</strong><br>
                                    <strong>= 91 days total</strong>
                                </div>
                            </div>
                        </div>
                        <div style="margin-top: 15px; padding: 10px; background: #fffbeb; border-radius: 6px; font-size: 13px;">
                            <strong>Total:</strong> 12 months Ã— 30 days = 360 days + 4 Tekufah days = <strong>364 days</strong>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-title">ğŸ¯ Fixed Festival Dates</div>
                        <div style="font-size: 14px; line-height: 2;">
                            Every year, festivals fall on the <strong>same weekday</strong>:<br><br>
                            
                            <div style="padding: 10px; background: #f0f4ff; border-radius: 6px; margin-bottom: 10px;">
                                <strong style="color: var(--primary);">ğŸ“… New Year (Nisan 1):</strong> Always <strong>Wednesday</strong><br>
                                <small style="color: #718096;">Start of the sacred year</small>
                            </div>
                            
                            <div style="padding: 10px; background: #f0f4ff; border-radius: 6px; margin-bottom: 10px;">
                                <strong style="color: var(--primary);">ğŸ· Passover (Nisan 15):</strong> Always <strong>Wednesday</strong><br>
                                <small style="color: #718096;">Exactly 2 weeks after New Year</small>
                            </div>
                            
                            <div style="padding: 10px; background: #f0f4ff; border-radius: 6px; margin-bottom: 10px;">
                                <strong style="color: var(--primary);">ğŸŒ¾ First Fruits (Nisan 26):</strong> Always <strong>Sunday</strong><br>
                                <small style="color: #718096;">Day after the Sabbath following Passover</small>
                            </div>
                            
                            <div style="padding: 10px; background: #f0f4ff; border-radius: 6px; margin-bottom: 10px;">
                                <strong style="color: var(--primary);">ğŸ“œ Pentecost (Sivan 15):</strong> Always <strong>Sunday</strong><br>
                                <small style="color: #718096;">Exactly 50 days after First Fruits</small>
                            </div>
                            
                            <div style="padding: 10px; background: #f0f4ff; border-radius: 6px; margin-bottom: 10px;">
                                <strong style="color: var(--primary);">ğŸ‡ New Wine (Av 3):</strong> Always <strong>Sunday</strong><br>
                                <small style="color: #718096;">50 days after Pentecost</small>
                            </div>
                            
                            <div style="padding: 10px; background: #f0f4ff; border-radius: 6px; margin-bottom: 10px;">
                                <strong style="color: var(--primary);">ğŸ«’ New Oil (Elul 22):</strong> Always <strong>Sunday</strong><br>
                                <small style="color: #718096;">50 days after New Wine</small>
                            </div>
                            
                            <div style="padding: 10px; background: #f0f4ff; border-radius: 6px; margin-bottom: 10px;">
                                <strong style="color: var(--primary);">ğŸ•Šï¸ Day of Atonement (Tishrei 10):</strong> Always <strong>Friday</strong><br>
                                <small style="color: #718096;">Day before the Sabbath</small>
                            </div>
                            
                            <div style="padding: 10px; background: #f0f4ff; border-radius: 6px; margin-bottom: 10px;">
                                <strong style="color: var(--primary);">ğŸŒ¿ Tabernacles (Tishrei 15):</strong> Always <strong>Wednesday</strong><br>
                                <small style="color: #718096;">Lasts 7 days through Tuesday</small>
                            </div>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-title">âš¡ Zadok Priestly Courses (Mishmarot)</div>
                        <p style="font-size: 14px; margin-bottom: 15px;">The 24 priestly courses serve in perfect rotation - each serves exactly twice per year:</p>
                        
                        <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; font-size: 12px; line-height: 1.8;">
                            <div>
                                <strong>1-8:</strong><br>
                                1. Jehoiarib<br>
                                2. Jedaiah<br>
                                3. Harim<br>
                                4. Seorim<br>
                                5. Malchijah<br>
                                6. Mijamin<br>
                                7. Hakkoz<br>
                                8. Abijah
                            </div>
                            <div>
                                <strong>9-16:</strong><br>
                                9. Jeshua<br>
                                10. Shecaniah<br>
                                11. Eliashib<br>
                                12. Jakim<br>
                                13. Huppah<br>
                                14. Jeshebeab<br>
                                15. Bilgah<br>
                                16. Immer
                            </div>
                            <div>
                                <strong>17-24:</strong><br>
                                17. Hezir<br>
                                18. Happizzez<br>
                                19. Pethahiah<br>
                                20. Jehezkel<br>
                                21. Jachin<br>
                                22. Gamul<br>
                                23. Delaiah<br>
                                24. Maaziah
                            </div>
                        </div>
                        
                        <div style="margin-top: 15px; padding: 12px; background: #e6fffa; border-radius: 6px; font-size: 13px;">
                            <strong>ğŸ“– Biblical Connection:</strong> Zechariah (John the Baptist's father) was from the course of <strong>Abijah</strong> (8th course) - Luke 1:5
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-title">ğŸ“ Mathematical Precision</div>
                        <div style="font-size: 14px; line-height: 1.8;">
                            <strong>Why 364 days is perfect:</strong><br><br>
                            
                            â€¢ <strong>52 weeks exactly:</strong> 364 Ã· 7 = 52 (no remainder!)<br>
                            â€¢ <strong>4 seasons equally:</strong> 364 Ã· 4 = 91 days each<br>
                            â€¢ <strong>13 weeks per season:</strong> 91 Ã· 7 = 13 weeks<br>
                            â€¢ <strong>Every date = same weekday:</strong> Perfect alignment forever<br><br>
                            
                            <div style="padding: 10px; background: #fffbeb; border-radius: 6px; margin-top: 10px;">
                                <strong>ğŸ”¢ The Formula:</strong><br>
                                12 months Ã— 30 days = 360 days<br>
                                + 4 Tekufah days (seasonal markers)<br>
                                = <strong>364 days total</strong>
                            </div>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-title">ğŸ“š Historical Background</div>
                        <div style="font-size: 14px; line-height: 1.8;">
                            <strong>Where this calendar comes from:</strong><br><br>
                            
                            â€¢ Found in the <strong>Dead Sea Scrolls</strong> at Qumran<br>
                            â€¢ Used by the <strong>Zadokite priests</strong><br>
                            â€¢ Mentioned in the <strong>Book of Jubilees</strong><br>
                            â€¢ Referenced in <strong>Book of Enoch</strong><br>
                            â€¢ Possibly used in <strong>First Temple period</strong><br><br>
                            
                            <div style="padding: 10px; background: #f0f4ff; border-radius: 6px;">
                                <strong>Why they used it:</strong> They believed the lunar calendar (which changes yearly) disrupted the proper timing of festivals. This solar calendar ensures festivals always align with the same days of the week, maintaining perfect liturgical order.
                            </div>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-title">ğŸ”— Learn More</div>
                        <a href="https://dsscalendar.org" class="external-link" target="_blank">
                            ğŸ“… Live DSS Calendar
                        </a>
                        <a href="https://www.createphotocalendars.com/Shop/ancientdeadseascrollcalendar" class="external-link" target="_blank">
                            ğŸ›’ Physical Calendar
                        </a>
                    </div>
                </div>
            </div>

            <!-- Resources Section -->
            <div class="content-section" id="resources">
                <div class="card">
                        <div class="card-title">Open Source Torah Sites</div>
                        <div id="resourcesList" data-role="resources"></div>
                        <p><strong>Complete Libraries:</strong></p>
                        <ul style="margin-left: 20px; margin-top: 10px; line-height: 1.8;">
                            <li><a href="https://www.sefaria.org" target="_blank">Sefaria.org</a> - Complete Jewish texts</li>
                            <li><a href="https://www.torahclass.com" target="_blank">TorahClass.com</a> - Video teachings</li>
                            <li><a href="https://www.mechon-mamre.org" target="_blank">Mechon Mamre</a> - Hebrew/English texts</li>
                        </ul>
                    
                    <p style="margin-top: 15px;"><strong>Public Domain Texts:</strong></p>
                    <ul style="margin-left: 20px; margin-top: 10px;">
                        <li>JPS 1917 Translation</li>
                        <li>Classical commentaries</li>
                        <li>Mishnah and Talmud</li>
                    </ul>
                </div>
            </div>

            <div class="toast" id="toast"></div>
    </div>

    <script>
        // Global State
        let selectedVerse = null;
        let currentBook = 'genesis';
        let currentChapter = 1;
        let notes = JSON.parse(localStorage.getItem('notes') || '[]');
        let highlights = JSON.parse(localStorage.getItem('highlights') || '[]');
        let calendarMonth = new Date().getMonth();
        let calendarYear = new Date().getFullYear();

        // Parasha Schedule for 5786 (2025-2026)
        const parashaSchedule = [
            { name: 'Bereshit', book: 'Genesis', start: '1:1', end: '6:8', date: '2025-10-25' },
            { name: 'Noach', book: 'Genesis', start: '6:9', end: '11:32', date: '2025-11-01' },
            { name: 'Lech-Lecha', book: 'Genesis', start: '12:1', end: '17:27', date: '2025-11-08' },
            { name: 'Vayera', book: 'Genesis', start: '18:1', end: '22:24', date: '2025-11-15' },
            { name: 'Chayei Sarah', book: 'Genesis', start: '23:1', end: '25:18', date: '2025-11-22' },
            { name: 'Toldot', book: 'Genesis', start: '25:19', end: '28:9', date: '2025-11-29' },
            { name: 'Vayetzei', book: 'Genesis', start: '28:10', end: '32:3', date: '2025-12-06' },
            { name: 'Vayishlach', book: 'Genesis', start: '32:4', end: '36:43', date: '2025-12-13' },
            { name: 'Vayeshev', book: 'Genesis', start: '37:1', end: '40:23', date: '2025-12-20' },
            { name: 'Miketz', book: 'Genesis', start: '41:1', end: '44:17', date: '2025-12-27' },
            { name: 'Vayigash', book: 'Genesis', start: '44:18', end: '47:27', date: '2026-01-03' },
            { name: 'Vayechi', book: 'Genesis', start: '47:28', end: '50:26', date: '2026-01-10' },
            { name: 'Shemot', book: 'Exodus', start: '1:1', end: '6:1', date: '2026-01-17' },
            { name: 'Vaera', book: 'Exodus', start: '6:2', end: '9:35', date: '2026-01-24' },
            { name: 'Bo', book: 'Exodus', start: '10:1', end: '13:16', date: '2026-01-31' },
            { name: 'Beshalach', book: 'Exodus', start: '13:17', end: '17:16', date: '2026-02-07' },
            { name: 'Yitro', book: 'Exodus', start: '18:1', end: '20:23', date: '2026-02-14' },
            { name: 'Mishpatim', book: 'Exodus', start: '21:1', end: '24:18', date: '2026-02-21' },
            { name: 'Terumah', book: 'Exodus', start: '25:1', end: '27:19', date: '2026-02-28' },
            { name: 'Tetzaveh', book: 'Exodus', start: '27:20', end: '30:10', date: '2026-03-07' },
            { name: 'Ki Tisa', book: 'Exodus', start: '30:11', end: '34:35', date: '2026-03-14' },
            { name: 'Vayakhel', book: 'Exodus', start: '35:1', end: '38:20', date: '2026-03-21' },
            { name: 'Pekudei', book: 'Exodus', start: '38:21', end: '40:38', date: '2026-03-28' },
            { name: 'Vayikra', book: 'Leviticus', start: '1:1', end: '5:26', date: '2026-04-04' },
            { name: 'Tzav', book: 'Leviticus', start: '6:1', end: '8:36', date: '2026-04-11' },
            { name: 'Shmini', book: 'Leviticus', start: '9:1', end: '11:47', date: '2026-04-18' },
            { name: 'Tazria', book: 'Leviticus', start: '12:1', end: '13:59', date: '2026-04-25' },
            { name: 'Metzora', book: 'Leviticus', start: '14:1', end: '15:33', date: '2026-05-02' },
            { name: 'Achrei Mot', book: 'Leviticus', start: '16:1', end: '18:30', date: '2026-05-09' },
            { name: 'Kedoshim', book: 'Leviticus', start: '19:1', end: '20:27', date: '2026-05-16' },
            { name: 'Emor', book: 'Leviticus', start: '21:1', end: '24:23', date: '2026-05-23' },
            { name: 'Behar', book: 'Leviticus', start: '25:1', end: '26:2', date: '2026-05-30' },
            { name: 'Bechukotai', book: 'Leviticus', start: '26:3', end: '27:34', date: '2026-06-06' },
            { name: 'Bamidbar', book: 'Numbers', start: '1:1', end: '4:20', date: '2026-06-13' },
            { name: 'Nasso', book: 'Numbers', start: '4:21', end: '7:89', date: '2026-06-20' },
            { name: 'Beha\'alotcha', book: 'Numbers', start: '8:1', end: '12:16', date: '2026-06-27' },
            { name: 'Sh\'lach', book: 'Numbers', start: '13:1', end: '15:41', date: '2026-07-04' },
            { name: 'Korach', book: 'Numbers', start: '16:1', end: '18:32', date: '2026-07-11' },
            { name: 'Chukat', book: 'Numbers', start: '19:1', end: '22:1', date: '2026-07-18' },
            { name: 'Balak', book: 'Numbers', start: '22:2', end: '25:9', date: '2026-07-25' },
            { name: 'Pinchas', book: 'Numbers', start: '25:10', end: '30:1', date: '2026-08-01' },
            { name: 'Matot', book: 'Numbers', start: '30:2', end: '32:42', date: '2026-08-08' },
            { name: 'Masei', book: 'Numbers', start: '33:1', end: '36:13', date: '2026-08-15' },
            { name: 'Devarim', book: 'Deuteronomy', start: '1:1', end: '3:22', date: '2026-08-22' },
            { name: 'Vaetchanan', book: 'Deuteronomy', start: '3:23', end: '7:11', date: '2026-08-29' },
            { name: 'Eikev', book: 'Deuteronomy', start: '7:12', end: '11:25', date: '2026-09-05' },
            { name: 'Re\'eh', book: 'Deuteronomy', start: '11:26', end: '16:17', date: '2026-09-12' },
            { name: 'Shoftim', book: 'Deuteronomy', start: '16:18', end: '21:9', date: '2026-09-19' },
            { name: 'Ki Teitzei', book: 'Deuteronomy', start: '21:10', end: '25:19', date: '2026-09-26' },
            { name: 'Ki Tavo', book: 'Deuteronomy', start: '26:1', end: '29:8', date: '2026-10-03' },
            { name: 'Nitzavim', book: 'Deuteronomy', start: '29:9', end: '30:20', date: '2026-10-10' },
            { name: 'Vayeilech', book: 'Deuteronomy', start: '31:1', end: '31:30', date: '2026-10-17' },
            { name: 'Ha\'Azinu', book: 'Deuteronomy', start: '32:1', end: '32:52', date: '2026-10-24' },
            { name: 'V\'Zot HaBerachah', book: 'Deuteronomy', start: '33:1', end: '34:12', date: '2026-10-31' }
        ];

        // Get current parasha based on today's date
        function getCurrentParasha() {
            const today = new Date();
            const todayStr = today.toISOString().split('T')[0];
            
            // Find the most recent parasha (or current week's)
            let currentParasha = parashaSchedule[0]; // Default to first
            
            for (let i = parashaSchedule.length - 1; i >= 0; i--) {
                if (todayStr >= parashaSchedule[i].date) {
                    currentParasha = parashaSchedule[i];
                    break;
                }
            }
            
            return currentParasha;
        }

        // Update the daily section with current parasha
        function updateDailyParasha() {
            const parasha = getCurrentParasha();
            const badge = document.querySelector('.card-badge');
            if (badge) {
                badge.textContent = parasha.name;
            }
            
            // Update title to show current portion
            const dailyTitle = document.querySelector('#daily .card-title');
            if (dailyTitle && dailyTitle.textContent.includes('Today')) {
                dailyTitle.textContent = `This Week's Torah Portion`;
            }
        }

        // Initialize on load
        window.onload = function() {
            updateHebrewDate();
            updateDailyParasha(); // NEW: Auto-set current parasha
            loadNotes();
            loadHighlights();
            renderCalendar();
            showToast('Welcome to The Way! ğŸ“–');
        };

        // Menu Functions
        function toggleMenu() {
            const menu = document.getElementById('dropdownMenu');
            menu.classList.toggle('show');
        }

        // Close menu when clicking outside
        document.addEventListener('click', function(e) {
            const menu = document.getElementById('dropdownMenu');
            const menuBtn = document.querySelector('.menu-btn');
            if (menu && !menu.contains(e.target) && e.target !== menuBtn) {
                menu.classList.remove('show');
            }
        });

        // Modal Functions
        function showModal(modalId) {
            document.getElementById('dropdownMenu').classList.remove('show');
            document.getElementById(modalId).classList.add('show');
        }

        function closeModal(modalId) {
            document.getElementById(modalId).classList.remove('show');
        }

        // Close modal when clicking on backdrop only (not inside modal content)
        function closeModalOnClick(e, modalId) {
            // Ensure event and targets exist, and only close when the backdrop itself was clicked
            if (e && e.currentTarget === e.target && e.target.classList && e.target.classList.contains('modal')) {
                closeModal(modalId);
            }
        }

        // Tab Functions
        function switchTab(el, tabName) {
            // tabs
            document.querySelectorAll('.nav-tab').forEach(t => t.classList.remove('active'));
            if (el && el.classList) el.classList.add('active');
            // sections
            document.querySelectorAll('.content-section').forEach(s => s.classList.remove('active'));
            const section = document.getElementById(tabName);
            if (section) section.classList.add('active');
            showToast('Switched to ' + tabName);
        }

        // Commentary Functions
    function loadCommentary(el, type) {
            const commentaries = {
                'rashi': 'In the beginning of God\'s creating the heavens and the earth. The text does not intend to point out the order of the acts of Creation...',
                'ibn-ezra': 'The word "beginning" refers to the beginning of time itself. Before this, there was no time, no space, only the infinite Ein Sof.',
                'sforno': 'God created everything ex nihilo, from absolute nothingness. This distinguishes the Biblical account from other ancient creation myths.',
                'ramban': 'The act of creation was not instantaneous but followed a divine plan. Each element was created in its proper time and sequence.'
            };

            // buttons
            document.querySelectorAll('.commentary-btn').forEach(b => b.classList.remove('active'));
            if (el && el.classList) el.classList.add('active');
            // content
            const content = document.getElementById('commentaryContent');
            if (content) {
                content.innerHTML =
                    `<strong>${type.charAt(0).toUpperCase() + type.slice(1).replace('-', ' ')} on Genesis 1:1:</strong><br>${commentaries[type] || ''}`;
            }
            showToast('Loaded ' + type + ' commentary');
        }

        // Interlinear Toggle
        function toggleInterlinear() {
            const interlinear = document.getElementById('interlinearText');
            const regular = document.getElementById('regularHebrew');
            
            if (interlinear.style.display === 'none') {
                interlinear.style.display = 'block';
                regular.style.display = 'none';
                showToast('Showing word-by-word translation');
            } else {
                interlinear.style.display = 'none';
                regular.style.display = 'block';
                showToast('Showing regular Hebrew');
            }
        }

        // Verse Selection
        function selectVerse(element) {
            // Remove previous selection
            document.querySelectorAll('.verse').forEach(v => {
                v.classList.remove('selected');
            });
            
            // Add selection
            element.classList.add('selected');
            selectedVerse = element.dataset.verse;
            
            showToast('Selected verse ' + selectedVerse);
        }

        // Highlight Verse
        function highlightVerse() {
            if (!selectedVerse) {
                showToast('Please select a verse first');
                return;
            }

            const verseElement = document.querySelector(`[data-verse="${selectedVerse}"]`);
            if (!verseElement) return;

            verseElement.classList.toggle('highlighted');
            
            if (verseElement.classList.contains('highlighted')) {
                if (!highlights.includes(selectedVerse)) {
                    highlights.push(selectedVerse);
                }
                showToast('Verse highlighted ğŸ–ï¸');
            } else {
                highlights = highlights.filter(v => v !== selectedVerse);
                showToast('Highlight removed');
            }

            localStorage.setItem('highlights', JSON.stringify(highlights));
        }

        // Note Functions
        function showNoteInput() {
            if (!selectedVerse) {
                showToast('Please select a verse first');
                return;
            }

            document.getElementById('noteInput').style.display = 'block';
            document.getElementById('noteTextarea').focus();
        }

        function hideNoteInput() {
            document.getElementById('noteInput').style.display = 'none';
            document.getElementById('noteTextarea').value = '';
        }

        function saveNote() {
            const textarea = document.getElementById('noteTextarea');
            const noteText = textarea.value.trim();
            
            if (!noteText) {
                showToast('Please enter a note');
                return;
            }

            const note = {
                id: Date.now(),
                verse: selectedVerse,
                book: currentBook,
                chapter: currentChapter,
                text: noteText,
                date: new Date().toISOString()
            };

            notes.unshift(note);
            localStorage.setItem('notes', JSON.stringify(notes));
            
            hideNoteInput();
            loadNotes();
            
            showToast('Note saved! ğŸ“');
        }

        function loadNotes() {
            const container = document.getElementById('notesDisplay');
            if (!container) return;

            if (notes.length === 0) {
                container.innerHTML = '<p style="color: #718096; font-style: italic;">No notes yet. Select a verse and click "Note"</p>';
                return;
            }

            container.innerHTML = notes.map(note => `
                <div class="note-item">
                    <div class="note-verse">${note.book} ${note.chapter}:${note.verse}</div>
                    <div class="note-date">${new Date(note.date).toLocaleDateString()}</div>
                    <div class="note-text">${note.text}</div>
                    <button class="note-delete" onclick="deleteNote(${note.id})">ğŸ—‘ï¸ Delete</button>
                </div>
            `).join('');
        }

        function deleteNote(noteId) {
            if (!confirm('Delete this note?')) return;
            
            notes = notes.filter(note => note.id !== noteId);
            localStorage.setItem('notes', JSON.stringify(notes));
            loadNotes();
            showToast('Note deleted');
        }

        function loadHighlights() {
            highlights.forEach(verseRef => {
                const verseElement = document.querySelector(`[data-verse="${verseRef}"]`);
                if (verseElement) {
                    verseElement.classList.add('highlighted');
                }
            });
        }

        // Share Functions
        function shareVerse() {
            if (!selectedVerse) {
                showToast('Please select a verse first');
                return;
            }

            const verseElement = document.querySelector(`[data-verse="${selectedVerse}"]`);
            const verseText = verseElement.querySelector('.verse-text').textContent;
            const shareText = `${currentBook} ${selectedVerse}\n\n"${verseText}"\n\nâ€” The Way Torah Study`;

            if (navigator.clipboard) {
                navigator.clipboard.writeText(shareText);
                showToast('Verse copied to clipboard! ğŸ“‹');
            } else {
                showToast('Sharing not supported');
            }
        }

        function shareApp() {
            const shareText = 'Check out The Way - Free Torah Study App!\n' + window.location.href;
            
            if (navigator.clipboard) {
                navigator.clipboard.writeText(shareText);
                showToast('Link copied to clipboard! ğŸ“‹');
            } else {
                showToast('Sharing not supported');
            }
        }

        // Torah Content - Now loads from Sefaria API
        const torahBooks = {
            genesis: { name: 'Genesis', chapters: 50 },
            exodus: { name: 'Exodus', chapters: 40 },
            leviticus: { name: 'Leviticus', chapters: 27 },
            numbers: { name: 'Numbers', chapters: 36 },
            deuteronomy: { name: 'Deuteronomy', chapters: 34 }
        };

        // Cache for loaded chapters
        let torahCache = {};

        // Load verses from Sefaria API
        async function loadVersesFromAPI() {
            const bookName = torahBooks[currentBook].name;
            const cacheKey = `${currentBook}_${currentChapter}`;
            
            // Check cache first
            if (torahCache[cacheKey]) {
                renderVerses(torahCache[cacheKey]);
                return;
            }

            const container = document.getElementById('versesContainer');
            if (!container) return;

            // Show loading state
            container.innerHTML = '<div style="text-align: center; padding: 40px; color: #718096;">Loading verses...</div>';

            try {
                // Fetch from Sefaria API
                const response = await fetch(`https://www.sefaria.org/api/texts/${bookName}.${currentChapter}?context=0`);
                const data = await response.json();

                if (data.text && Array.isArray(data.text)) {
                    // Convert to our format
                    const verses = data.text.map((text, index) => ({
                        num: `${currentChapter}:${index + 1}`,
                        text: text
                    }));

                    // Cache it
                    torahCache[cacheKey] = verses;
                    
                    // Render it
                    renderVerses(verses);
                } else {
                    throw new Error('Invalid data format');
                }
            } catch (error) {
                console.error('Error loading verses:', error);
                
                // Fallback to sample content
                const verses = Array.from({length: 10}, (_, i) => ({
                    num: `${currentChapter}:${i + 1}`,
                    text: `${bookName} chapter ${currentChapter}, verse ${i + 1}. (Enable internet connection to load full text from Sefaria.org)`
                }));
                
                renderVerses(verses);
                showToast('Offline mode - using sample text');
            }
        }

        // Render verses to DOM
        function renderVerses(verses) {
            const container = document.getElementById('versesContainer');
            if (!container) return;

            // Clear selected verse when switching
            selectedVerse = null;

            // Render verses
            container.innerHTML = verses.map(verse => `
                <div class="verse ${highlights.includes(verse.num) ? 'highlighted' : ''}" 
                     data-verse="${verse.num}" 
                     onclick="selectVerse(this)">
                    <span class="verse-number">${verse.num}</span> 
                    <span class="verse-text">${verse.text}</span>
                </div>
            `).join('');
        }

        // Book/Chapter Navigation
        function selectBook(book) {
            currentBook = book;
            currentChapter = 1;
            
            // Update button styles using data-book attribute
            const bookButtons = document.querySelectorAll('.book-select-btn');
            bookButtons.forEach(btn => {
                if (btn.getAttribute('data-book') === book) {
                    btn.className = 'btn btn-primary book-select-btn';
                } else {
                    btn.className = 'btn btn-secondary book-select-btn';
                }
            });
            
            updateChapterDisplay();
            loadVersesFromAPI();
            showToast('Switched to ' + torahBooks[book].name);
        }

        function changeChapter(direction) {
            if (direction === 0) {
                showToast(`${torahBooks[currentBook].name} ${currentChapter}`);
                return;
            }

            currentChapter += direction;

            if (currentChapter < 1) {
                currentChapter = 1;
                showToast('Already at first chapter');
                return;
            }

            const maxChapters = torahBooks[currentBook].chapters;
            if (currentChapter > maxChapters) {
                currentChapter = maxChapters;
                showToast('Already at last chapter');
                return;
            }

            updateChapterDisplay();
            loadVersesFromAPI(); // Changed from loadVerses()
            showToast(`${torahBooks[currentBook].name} ${currentChapter}`);
        }

        function updateChapterDisplay() {
            document.getElementById('currentBook').textContent = torahBooks[currentBook].name;
            document.getElementById('currentChapter').textContent = currentChapter;
        }

        // Calculate DSS Calendar Date
        function calculateDSSDate() {
            const today = new Date();
            const year = today.getFullYear();
            
            // DSS calendar starts on Wednesday after Spring Equinox (approx March 20)
            const springEquinox = new Date(year, 2, 20); // March 20
            let dssNewYear = new Date(springEquinox);
            
            // Find the first Wednesday after spring equinox
            while (dssNewYear.getDay() !== 3) { // 3 = Wednesday
                dssNewYear.setDate(dssNewYear.getDate() + 1);
            }
            
            // Calculate days since DSS New Year
            const daysSinceNewYear = Math.floor((today - dssNewYear) / (1000 * 60 * 60 * 24));
            
            const dssMonths = [
                'Nisan', 'Iyar', 'Sivan',        // Spring (1-3)
                'Tammuz', 'Av', 'Elul',          // Summer (4-6)
                'Tishrei', 'Cheshvan', 'Kislev', // Fall (7-9)
                'Tevet', 'Shevat', 'Adar'        // Winter (10-12)
            ];
            
            const dayNames = ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Sabbath'];
            
            let dssMonth, dssDay, season;
            
            if (daysSinceNewYear >= 0 && daysSinceNewYear < 364) {
                // Calculate which quarter (season)
                const quarter = Math.floor(daysSinceNewYear / 91);
                const dayInQuarter = daysSinceNewYear % 91;
                
                // Each month is 30 days, plus Tekufah day at end of quarter
                if (dayInQuarter < 30) {
                    dssMonth = dssMonths[quarter * 3];
                    dssDay = dayInQuarter + 1;
                } else if (dayInQuarter < 60) {
                    dssMonth = dssMonths[quarter * 3 + 1];
                    dssDay = dayInQuarter - 30 + 1;
                } else if (dayInQuarter < 90) {
                    dssMonth = dssMonths[quarter * 3 + 2];
                    dssDay = dayInQuarter - 60 + 1;
                } else {
                    // Tekufah day
                    const seasons = ['Spring', 'Summer', 'Fall', 'Winter'];
                    dssMonth = 'Tekufah';
                    dssDay = seasons[quarter];
                }
                
                const seasons = ['ğŸŒ¸ Spring', 'â˜€ï¸ Summer', 'ğŸ‚ Fall', 'â„ï¸ Winter'];
                season = seasons[quarter];
                
                // Display current DSS date
                const dssDateElement = document.getElementById('dssCurrentDate');
                if (dssDateElement) {
                    const currentDayName = dayNames[today.getDay()];
                    if (dssMonth === 'Tekufah') {
                        dssDateElement.innerHTML = `
                            <strong>Tekufah Day - ${dssDay} Quarter</strong><br>
                            <span style="font-size: 14px;">${currentDayName} | ${season}</span>
                        `;
                    } else {
                        dssDateElement.innerHTML = `
                            <strong>${dssDay} ${dssMonth} 5786</strong><br>
                            <span style="font-size: 14px;">${currentDayName} | ${season}</span>
                        `;
                    }
                }
            } else {
                const dssDateElement = document.getElementById('dssCurrentDate');
                if (dssDateElement) {
                    dssDateElement.textContent = 'Calculating...';
                }
            }
        }

        // Calendar Functions
        function switchCalendar(el, type) {
            // buttons
            document.querySelectorAll('.calendar-type-btn').forEach(b => b.classList.remove('active'));
            if (el && el.classList) el.classList.add('active');
            // views
            const heb = document.getElementById('hebrewCalendar');
            const dss = document.getElementById('dssCalendar');
            if (type === 'hebrew') {
                if (heb) heb.style.display = 'block';
                if (dss) dss.style.display = 'none';
                renderCalendar();
            } else {
                if (heb) heb.style.display = 'none';
                if (dss) dss.style.display = 'block';
                calculateDSSDate();
            }
            showToast('Switched to ' + (type === 'hebrew' ? 'Hebrew' : 'DSS') + ' calendar');
        }

        function changeMonth(direction) {
            if (direction === 0) {
                // Today button
                const today = new Date();
                calendarMonth = today.getMonth();
                calendarYear = today.getFullYear();
            } else {
                calendarMonth += direction;
                
                if (calendarMonth > 11) {
                    calendarMonth = 0;
                    calendarYear++;
                } else if (calendarMonth < 0) {
                    calendarMonth = 11;
                    calendarYear--;
                }
            }
            
            renderCalendar();
        }

        function renderCalendar() {
            const monthNames = [
                'January', 'February', 'March', 'April', 'May', 'June',
                'July', 'August', 'September', 'October', 'November', 'December'
            ];

            const hebrewMonths = ['Tishrei', 'Cheshvan', 'Kislev', 'Tevet', 'Shevat', 'Adar', 
                                 'Nissan', 'Iyar', 'Sivan', 'Tammuz', 'Av', 'Elul'];

            const festivals = {
                '2025-10-03': 'ğŸº Rosh Hashanah',
                '2025-10-12': 'ğŸ•Šï¸ Yom Kippur',
                '2025-10-17': 'ğŸŒ¿ Sukkot',
                '2025-12-25': 'ğŸ• Chanukah'
            };

            const grid = document.getElementById('calendarGrid');
            if (!grid) return;

            grid.innerHTML = '';

            // Update title
            document.getElementById('currentMonth').textContent = 
                `${monthNames[calendarMonth]} ${calendarYear}`;

            // Day headers
            const dayHeaders = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
            dayHeaders.forEach(day => {
                const header = document.createElement('div');
                header.className = 'calendar-day-header';
                header.textContent = day;
                grid.appendChild(header);
            });

            const firstDay = new Date(calendarYear, calendarMonth, 1).getDay();
            const daysInMonth = new Date(calendarYear, calendarMonth + 1, 0).getDate();
            const daysInPrevMonth = new Date(calendarYear, calendarMonth, 0).getDate();

            // Previous month days
            for (let i = firstDay - 1; i >= 0; i--) {
                const day = document.createElement('div');
                day.className = 'calendar-day';
                day.style.opacity = '0.3';
                day.innerHTML = `<div class="calendar-day-number">${daysInPrevMonth - i}</div>`;
                grid.appendChild(day);
            }

            // Current month days
            const today = new Date();
            for (let date = 1; date <= daysInMonth; date++) {
                const dateStr = `${calendarYear}-${String(calendarMonth + 1).padStart(2, '0')}-${String(date).padStart(2, '0')}`;
                const dayOfWeek = new Date(calendarYear, calendarMonth, date).getDay();
                
                const day = document.createElement('div');
                day.className = 'calendar-day';
                
                // Today
                if (calendarYear === today.getFullYear() && 
                    calendarMonth === today.getMonth() && 
                    date === today.getDate()) {
                    day.className += ' today';
                }
                
                // Shabbat
                if (dayOfWeek === 6) {
                    day.className += ' shabbat';
                }
                
                let dayContent = `<div class="calendar-day-number">${date}</div>`;
                
                // Hebrew date
                const hebrewDay = ((date - 1) % 30) + 1;
                const hebrewMonthIndex = (calendarMonth + 6) % 12;
                dayContent += `<div class="calendar-day-hebrew">${hebrewDay} ${hebrewMonths[hebrewMonthIndex]}</div>`;
                
                // Festivals
                if (festivals[dateStr]) {
                    dayContent += `<div class="calendar-festival">${festivals[dateStr]}</div>`;
                }
                
                day.innerHTML = dayContent;
                grid.appendChild(day);
            }

            // Next month days
            const totalCells = firstDay + daysInMonth;
            const cellsToAdd = totalCells % 7 === 0 ? 0 : 7 - (totalCells % 7);
            
            for (let date = 1; date <= cellsToAdd; date++) {
                const day = document.createElement('div');
                day.className = 'calendar-day';
                day.style.opacity = '0.3';
                day.innerHTML = `<div class="calendar-day-number">${date}</div>`;
                grid.appendChild(day);
            }
        }

        // Hebrew Date
        function updateHebrewDate() {
            const today = new Date();
            const dayNames = ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Shabbat'];
            const dayOfWeek = dayNames[today.getDay()];
            
            const hebrewMonths = ['Tishrei', 'Cheshvan', 'Kislev', 'Tevet', 'Shevat', 'Adar', 
                                 'Nissan', 'Iyar', 'Sivan', 'Tammuz', 'Av', 'Elul'];
            
            const monthIndex = (today.getMonth() + 6) % 12;
            const hebrewYear = 5786;
            const hebrewDay = today.getDate();
            
            document.getElementById('hebrewDate').textContent = 
                `${hebrewDay} ${hebrewMonths[monthIndex]} ${hebrewYear} | ${dayOfWeek}`;
        }

        // Toast Notification
        function showToast(message) {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.classList.add('show');
            
            setTimeout(() => {
                toast.classList.remove('show');
            }, 3000);
        }

        // Mobile swipe support
        let touchStartX = 0;
        let touchEndX = 0;

        document.addEventListener('touchstart', e => {
            touchStartX = e.changedTouches[0].screenX;
        }, { passive: true });

        document.addEventListener('touchend', e => {
            touchEndX = e.changedTouches[0].screenX;
            handleSwipe();
        }, { passive: true });

        function handleSwipe() {
            const diff = touchStartX - touchEndX;
            const threshold = 75;
            
            if (Math.abs(diff) > threshold) {
                const tabs = ['daily', 'torah', 'parasha', 'calendar', 'resources'];
                const activeTab = document.querySelector('.nav-tab.active');
                const currentIndex = Array.from(document.querySelectorAll('.nav-tab')).indexOf(activeTab);
                
                let newIndex = currentIndex;
                
                if (diff > 0 && currentIndex < tabs.length - 1) {
                    newIndex = currentIndex + 1;
                } else if (diff < 0 && currentIndex > 0) {
                    newIndex = currentIndex - 1;
                }
                
                if (newIndex !== currentIndex) {
                    const newTab = document.querySelectorAll('.nav-tab')[newIndex];
                    if (newTab) {
                        // Simulate click
                        document.querySelectorAll('.nav-tab').forEach(tab => tab.classList.remove('active'));
                        document.querySelectorAll('.content-section').forEach(section => section.classList.remove('active'));
                        newTab.classList.add('active');
                        document.getElementById(tabs[newIndex]).classList.add('active');
                        showToast('Switched to ' + tabs[newIndex]);
                    }
                }
            }
        }

        // Keyboard shortcuts
        document.addEventListener('keydown', e => {
            if ((e.ctrlKey || e.metaKey) && e.key === 's') {
                e.preventDefault();
                const noteInput = document.getElementById('noteInput');
                if (noteInput && noteInput.style.display !== 'none') {
                    saveNote();
                }
            }

            if (e.key === 'Escape') {
                const noteInput = document.getElementById('noteInput');
                if (noteInput && noteInput.style.display !== 'none') {
                    hideNoteInput();
                }
                
                // Close modals
                document.querySelectorAll('.modal').forEach(modal => {
                    modal.classList.remove('show');
                });
            }
        });

        console.log('ğŸ“– The Way - Torah Study App v2.0');
        console.log('âœ… All features functional and ready!');
    </script>
        <script>
        // --- Resilient Calendar & Resources (safe fallbacks & diagnostics) ---
        // Utilities
        function first(...sels) {
            for (const s of sels) { const el = document.querySelector(s); if (el) return el; }
            return null;
        }
        function ensureArray(x) { return Array.isArray(x) ? x : []; }
        function logWarnOnce(key, msg) {
            window.__warned ??= new Set();
            if (!window.__warned.has(key)) { console.warn(msg); window.__warned.add(key); }
        }

        // Guard globals
        window.commentaries ||= {};
        window.resources   ||= [];
        window.calendars   ||= {};

        // Resources renderer
        function renderResources() {
            const list = first('#resourcesList', '#resources', '[data-role="resources"]');
            if (!list) {
                logWarnOnce('resources-container-missing', 'Resources container not found (expected #resourcesList/#resources/[data-role="resources"]).');
                return;
            }
            const items = ensureArray(window.resources);
            if (items.length === 0) {
                list.innerHTML = `\n      <div class="empty-state">\n        <h3>No resources yet</h3>\n        <p>We couldn't find any resources to display.</p>\n        <ul class="hints">\n          <li>Check that <code>window.resources</code> is defined and is an array.</li>\n        </ul>\n        <button type="button" onclick="renderResources()" class="btn">Retry</button>\n      </div>\n    `;
                logWarnOnce('resources-empty', 'window.resources is empty; showing empty-state.');
                return;
            }
            const html = items.map((r, i) => {
                const title = r?.title || `Resource ${i+1}`;
                const href  = r?.href  || null;
                const desc  = r?.desc  || '';
                return `\n      <article class="resource-card">\n        <h4>${href ? `<a href="${href}" target="_blank" rel="noopener">${title}</a>` : title}</h4>\n        ${desc ? `<p>${desc}</p>` : ''}\n      </article>\n    `;
            }).join('');
            list.innerHTML = html;
        }

        // Calendar renderer
        function startOfWeek(d) { const x = new Date(d); const day = x.getDay(); const diff = (day + 6) % 7; x.setDate(x.getDate() - diff); x.setHours(0,0,0,0); return x; }
        function formatYMD(d) { return `${d.getFullYear()}-${String(d.getMonth()+1).padStart(2,'0')}-${String(d.getDate()).padStart(2,'0')}`; }
        function renderCalendar(type = 'weekly') {
            const wrap = first('#calendarGrid', '#calendar', '#calendarContainer', '[data-role="calendar"]');
            if (!wrap) { logWarnOnce('calendar-container-missing', 'Calendar container not found (expected #calendarGrid/#calendar/#calendarContainer/[data-role="calendar"]).'); return; }
            const data = window.calendars?.[type];
            if (!Array.isArray(data) || data.length === 0) {
                const today = new Date(); const weekStart = startOfWeek(today);
                const days = Array.from({length:7}, (_,i) => { const d = new Date(weekStart); d.setDate(weekStart.getDate()+i); return { date: formatYMD(d), title: i===0 ? 'Week Start' : 'Daily Reading', notes: i===0 ? 'Fallback calendar. Supply window.calendars to replace.' : 'Placeholder entry.' }; });
                wrap.innerHTML = `\n      <div class="empty-state info">\n        <h3>Showing fallback ${type} calendar</h3>\n        <p>Provide <code>window.calendars['${type}']</code> with an array of entries to replace this.</p>\n      </div>\n      <div class="calendar-list">\n        ${days.map(d => `\n          <div class="cal-day">\n            <div class="cal-date">${d.date}</div>\n            <div class="cal-title">${d.title}</div>\n            <div class="cal-notes">${d.notes}</div>\n          </div>\n        `).join('')}\n      </div>\n    `;
                logWarnOnce('calendar-fallback', `No data for calendars['${type}']; rendered fallback week.`);
                return;
            }
            wrap.innerHTML = `\n    <div class="calendar-list">\n      ${data.map((entry,i) => `\n        <div class="cal-day">\n          <div class="cal-date">${entry?.date ?? `Day ${i+1}`}</div>\n          <div class="cal-title">${entry?.title ?? 'Reading'}</div>\n          ${entry?.notes ? `<div class="cal-notes">${entry.notes}</div>` : ''}\n        </div>\n      `).join('')}\n    </div>\n  `;
        }

        // Safe switches
        function switchCalendarSafe(el, type) {
            try {
                if (el?.closest) {
                    const group = el.closest('[data-role="calendar-tabs"]');
                    if (group) group.querySelectorAll('[aria-current="page"]').forEach(b => b.removeAttribute('aria-current'));
                    el?.setAttribute?.('aria-current', 'page');
                }
                renderCalendar(type || 'weekly');
            } catch (e) { console.error('switchCalendar error:', e); }
        }
        function loadResources() { try { renderResources(); } catch (e) { console.error('renderResources error:', e); } }

        document.addEventListener('DOMContentLoaded', () => { try { renderResources(); } catch {} try { renderCalendar('weekly'); } catch {} });
        </script>
</body>
</html>
